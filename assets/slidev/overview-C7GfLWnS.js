import{d as te,e as ne,_ as oe,f as le}from"../modules/unplugin-icons-D9kGfLix.js";import{d as G,ab as ae,ac as ie,t as N,ad as se,E as P,D as ce,a4 as re,n as J,B as o,o as i,c as v,i as E,h as z,ae as de,af as ue,b as k,j as me,K as pe,z as L,R as he,O as fe,e as r,F as U,ag as j,k as H,x,g as I,l as y}from"../modules/vue-rOHTgtFx.js";import{u as ve,a as ge,s as ke,c as _e,C as q,i as be,b as V,t as xe,g as X,p as ye}from"../index-C0ChEDTH.js";import{u as we,S as Ce,_ as $e,a as De}from"./DrawingPreview.vue_vue_type_script_setup_true_lang-DpYAZm-m.js";import{_ as K}from"./IconButton.vue_vue_type_script_setup_true_lang-CmtClDt8.js";import{_ as Se,C as Ee}from"./ClicksSlider-B6RVPbif.js";import"../modules/shiki-C4tUuVoI.js";const Me=["placeholder"],He=G({__name:"NoteEditable",props:{no:{type:Number,required:!0},class:{default:""},editing:{default:!1},style:{default:()=>({})},placeholder:{default:"No notes for this slide"},clicksContext:{type:Object},highlight:{default:!0},autoHeight:{default:!1}},emits:["update:editing","markerDblclick","markerClick"],setup(w,{emit:T}){const m=w,s=ae(m,"editing",T,{passive:!0}),{info:C,update:$}=we(ie(m,"no")),c=N("");let _;const{ignoreUpdates:R}=se(c,l=>{if(!s.value)return;const u=m.no;clearTimeout(_),_=setTimeout(()=>{$({note:l},u)},500)});P(()=>{var l;return(l=C.value)==null?void 0:l.note},(l="")=>{s.value||(clearTimeout(_),R(()=>{c.value=l}))},{immediate:!0,flush:"sync"});const p=N(),f=N();ce(()=>{var l;s.value&&((l=p.value)==null||l.focus())}),re(p,()=>{s.value=!1});function M(){!m.autoHeight||!p.value||!s.value||p.value.scrollHeight>p.value.clientHeight&&(p.value.style.height=`${p.value.scrollHeight}px`)}function b(l){s.value&&l.metaKey&&l.key==="s"&&(l.preventDefault(),$({note:c.value},m.no))}return P([c,s],()=>{J(()=>{M()})},{flush:"post",immediate:!0}),(l,u)=>{var W;return o(s)?de((i(),k("textarea",{key:1,ref_key:"inputEl",ref:p,"onUpdate:modelValue":u[2]||(u[2]=g=>c.value=g),class:E(["prose resize-none overflow-auto outline-none bg-transparent block border-primary border-2",m.class]),style:z([{"line-height":"1.75"},[m.style,f.value!=null?{height:`${f.value}px`}:{}]]),placeholder:w.placeholder,onKeydown:[u[3]||(u[3]=me(g=>s.value=!1,["esc"])),b]},null,46,Me)),[[ue,c.value]]):(i(),v(Se,{key:0,class:E(["border-transparent border-2",[m.class,c.value?"":"opacity-25 italic select-none"]]),style:z(m.style),note:c.value||w.placeholder,"note-html":(W=o(C))==null?void 0:W.noteHTML,"clicks-context":w.clicksContext,"auto-scroll":!w.autoHeight,highlight:m.highlight,onMarkerClick:u[0]||(u[0]=(g,D)=>T("markerClick",g,D)),onMarkerDblclick:u[1]||(u[1]=(g,D)=>T("markerDblclick",g,D))},null,8,["class","style","note","note-html","clicks-context","auto-scroll","highlight"]))}}}),Ne={class:"h-screen w-screen of-hidden flex"},Te={class:"grid grid-rows-[auto_max-content] border-r border-main select-none max-h-full h-full"},We={class:"relative"},Be={class:"absolute left-0 top-0 bottom-0 w-200 flex flex-col flex-auto items-end group p2 gap-1 max-h-full of-x-visible of-y-auto",style:{direction:"rtl"}},Ie=["onClick"],Ve={p2:"",border:"t main"},Ke={class:"select-none w-13 text-right my4 flex flex-col gap-1 items-end"},ze={class:"text-3xl op20 mb2"},Re=["onDblclick"],Le={class:"py3 mt-0.5 mr--8 ml--4 op0 transition group-hover:op100"},Oe={key:0,class:"select-none absolute bottom-0 right-0 bg-main rounded-tl p2 op35 text-xs"},Ae={class:"absolute top-0 right-0 px3 py1.5 border-b border-l rounded-lb bg-main border-main select-none"},Fe={class:"text-xs op50"},Ye=G({__name:"overview",setup(w){ve({title:`Overview - ${ke}`});const{openInEditor:m,slides:s}=ge(),C=pe(new Map),$=N([]),c=N(null),_=L(()=>s.value.map(t=>{var e,a;return W(((a=(e=t.meta)==null?void 0:e.slide)==null?void 0:a.note)||"")})),R=L(()=>_.value.reduce((t,e)=>t+e,0)),p=L(()=>s.value.map(t=>l(t)).reduce((t,e)=>t+e,0)),f=he(),M=new WeakMap;function b(t){return M.has(t)||M.set(t,_e(t,q)),M.get(t)}function l(t){var e,a;return((e=t.meta)==null?void 0:e.clicks)||((a=b(t))==null?void 0:a.total)}function u(t){f.value===t?f.value=void 0:f.value=t}function W(t){var e;return((e=t.match(/[\w`'\-]+/g))==null?void 0:e.length)||0}function g(t){const e=t.getBoundingClientRect(),a=20;return e.top>=0-a&&e.left>=0-a&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)+a&&e.right<=(window.innerWidth||document.documentElement.clientWidth)+a}function D(){const t=[];Array.from(C.entries()).forEach(([e,a])=>{g(a)&&t.push(e)}),$.value=t}function O(t){const e=document.createElement("a");e.target="_blank",e.href=ye+t.slice(1),e.click()}function Q(t){const e=C.get(t);e&&e.scrollIntoView({behavior:"smooth",block:"start"})}function Y(t,e,a){const S=b(a);S.current===e?S.current=q:S.current=e,t.preventDefault()}return fe(()=>{J(()=>{D()})}),(t,e)=>{const a=te,S=ne,Z=oe,ee=le;return i(),k("div",Ne,[r("nav",Te,[r("div",We,[r("div",Be,[(i(!0),k(U,null,j(o(s),(n,h)=>{var d,B,A,F;return i(),k("div",{key:n.no,class:"relative",style:{direction:"ltr"}},[r("button",{class:E(["relative transition duration-300 w-8 h-8 rounded hover:bg-active hover:op100",$.value.includes(h)?"op100 text-primary bg-gray:5":"op20"]),onClick:Pe=>Q(h)},[r("div",null,x(h+1),1)],10,Ie),(B=(d=n.meta)==null?void 0:d.slide)!=null&&B.title?(i(),k("div",{key:0,class:E(["pointer-events-none select-none absolute left-110% backdrop-blur-8 top-50% translate-y--50% ws-nowrap z-10 px2 shadow-xl rounded border border-main transition duration-400 op0 group-hover:op100",$.value.includes(h)?"text-primary":"text-main important-text-op-50"])},x((F=(A=n.meta)==null?void 0:A.slide)==null?void 0:F.title),3)):I("",!0)])}),128))])]),r("div",Ve,[o(be)?(i(),v(K,{key:1,title:o(V)?"Dark mode":"Light mode","pointer-events-none":"",op50:""},{default:H(()=>[o(V)?(i(),v(a,{key:0})):(i(),v(S,{key:1}))]),_:1},8,["title"])):(i(),v(K,{key:0,title:o(V)?"Switch to light mode theme":"Switch to dark mode theme",onClick:e[0]||(e[0]=n=>o(xe)())},{default:H(()=>[o(V)?(i(),v(a,{key:0})):(i(),v(S,{key:1}))]),_:1},8,["title"]))])]),r("main",{class:"flex-1 h-full of-auto",style:z("grid-template-columns: repeat(auto-fit,minmax(450px,1fr))"),onScroll:D},[(i(!0),k(U,null,j(o(s),(n,h)=>(i(),k("div",{key:n.no,ref_for:!0,ref:d=>C.set(h,d),class:E(["relative border-t border-main of-hidden flex gap-4 min-h-50 group",h===0?"pt5":""])},[r("div",Ke,[r("div",ze,x(h+1),1),y(K,{class:"mr--3 op0 group-hover:op80",title:"Play in new tab",onClick:d=>O(o(X)(n,!1))},{default:H(()=>[y(Z)]),_:2},1032,["onClick"]),I("",!0)]),r("div",{class:"flex flex-col gap-2 my5",style:z({width:"450px"})},[r("div",{class:"border rounded border-main overflow-hidden bg-main select-none h-max",onDblclick:d=>O(o(X)(n,!1))},[(i(),v(De,{key:n.no,width:450,class:"pointer-events-none important:[&_*]:select-none"},{default:H(()=>[y(Ce,{"clicks-context":b(n),route:n,"render-context":"overview"},null,8,["clicks-context","route"]),y($e,{page:n.no},null,8,["page"])]),_:2},1024))],40,Re),l(n)?(i(),v(Ee,{key:0,active:o(f)===n,"clicks-context":b(n),class:"w-full mt-2",onDblclick:d=>u(n),onClick:d=>f.value=n},null,8,["active","clicks-context","onDblclick","onClick"])):I("",!0)],4),r("div",Le,[y(K,{title:"Edit Note",class:E(["rounded-full w-9 h-9 text-sm",c.value===n.no?"important:op0":""]),onClick:d=>c.value=n.no},{default:H(()=>[y(ee)]),_:2},1032,["class","onClick"])]),y(He,{no:n.no,class:"max-w-250 w-250 text-lg rounded p3","auto-height":!0,highlight:o(f)===n,editing:c.value===n.no,"clicks-context":b(n),onDblclick:d=>c.value!==n.no?c.value=n.no:null,"onUpdate:editing":e[1]||(e[1]=d=>c.value=null),onMarkerClick:(d,B)=>Y(d,B,n)},null,8,["no","highlight","editing","clicks-context","onDblclick","onMarkerClick"]),o(_)[h]>0?(i(),k("div",Oe,x(o(_)[h])+" words ",1)):I("",!0)],2))),128))],36),r("div",Ae,[r("div",Fe,x(o(s).length)+" slides · "+x(o(p)+o(s).length-1)+" clicks · "+x(o(R))+" words ",1)])])}}});export{Ye as default};
